<style type="text/css">.D2{width:100%;height:100%;position:absolute;top:0;left:0;z-index:99}.D2 .DCont{*zoom:1}.D2 .bg{background:#FFF;position:absolute;top:0;left:0;width:100%;height:100%;filter:alpha(opacity=0);-moz-opacity:0;opacity:0;-height:expression(document.body.scrollHeight > document.body.offsetHeight ? document.body.scrollHeight : document.body.offsetHeight + "px")}.D2 iframe.cover_select{width:100%;height:100%;position:absolute;filter:alpha(opacity=0);-moz-opacity:0;opacity:0;z-index:-1;display:none;-display:}.D2 .DLoad{filter:alpha(opacity=50);-moz-opacity:0.5;opacity:0.5;position:absolute;z-index:5;background:url(http://mat1.gtimg.com/www/mb/images/loading.gif) #FFF 50% 50% no-repeat;}.D2 .CR{position:absolute;top:50%;left:50%;margin:0 0 0 -9999px}.D2 .DTitle,.D2 .ico_skin,.DtabTitle,.ico_lock,.D2 .funBoxx,.themebg_sel button,.themebg .del,.bgPosition,.bgPosition a.select,.D2 .color,.palettes .mask,.themeDiy .pages a{background:url(http://mat1.gtimg.com/www/mb/images/skinBg1d.png) no-repeat}.D2 .DTitle{cursor:move;height:36px;overflow:hidden;padding-left:10px;font-family:Simsun;font-size:14px;line-height:35px;font-weight:bold;border-bottom:1px solid #D5D5D5;background-position:0 -34px;background-repeat:repeat-x}.D2 .ico_skin{float:left;margin:9px 5px 0 0;_margin-right:0;background-position:0 -124px}.D2 .close{position:absolute;float:none;top:12px;right:12px;margin:0}.D2 .DWrap{width:586px;padding:1px;border:1px solid #7B828B;background:#fff;filter:progid:DXImageTransform.Microsoft.Shadow(color="#909090",Direction=135,Strength=4);-moz-box-shadow:2px 2px 5px #909090;-webkit-box-shadow:2px 2px 5px #909090}.D2 .pages{width:544px;margin:0 auto;padding:10px 5px 8px;border-bottom:1px dotted #C9C9C9}.D2 .pages .disabled{color:#999;cursor:default;text-decoration:none;background:none}
.funBoxx{padding-top:9px;text-align:center;background-position:0 -75px;background-repeat:repeat-x}.D2 .btn_save{margin-right:10px}.DtabTitle{height:29px;padding-right:10px;*zoom:1;overflow:hidden;line-height:29px;background-repeat:repeat-x}.DtabTitle ul{float:left}.DtabTitle li{display:inline-block;float:left;margin-left:-1px;border:1px solid #D5D5D5;border-width:0 1px}.DtabTitle li.select{padding:0 15px;background:#fff}.DtabTitle li a{display:block;padding:0 15px}.DtempList{width:556px;height:188px;margin:10px 0 0 20px}.DtempList li{position:relative;float:left;width:129px;height:84px;margin:10px 10px 0 0;color:#fff;line-height:19px;text-align:center;cursor:pointer}.DtempList img{margin:1px;width:121px;height:76px;padding:2px;border:1px solid #DFDFDF}

.DtempList .tempName,.DtempList .mask{position:absolute;z-index:2;left:4px;bottom:4px;width:121px;height:19px}.DtempList .ico_lock{display:none;position:absolute;z-index:2;left:6px;top:6px;width:11px;height:16px;background-position:-20px -125px}.DtempList .mask{z-index:1;background:#000;filter:alpha(opacity:70);opacity:0.7}.DtempList li.hover img{border-color:#32A1CC}.DtempList .select img{margin:0;border:2px solid #32A1CC}.DtempList .locked img{border-color:#5F5F5F!important;background:#fff;filter:alpha(opacity:20);opacity:0.2}.DtempList .locked .ico_lock{display:block}.themeDiy{width:558px;height:213px;margin:20px auto 0;color:#999;border-bottom:1px dotted #C9C9C9}.themebgWrap{float:right;width:283px;height:203px;border:1px solid #DFDFDF}.themebg_sel{position:relative;height:49px;padding:10px 8px 0;line-height:25px;background:#EBEBEB}.themebg_sel .inputTxt{width:180px;margin-right:5px;border:1px solid #C5C5C5;position:relative;z-index:1;cursor:pointer}.themebg_sel button{width:60px;height:21px;border:0;background-position:0 -145px}.selfilemask{position:absolute;z-index:100;width:20px;height:20px;overflow:hidden;*zoom:1;filter:alpha(opacity:0);opacity:0}.selfilemask input{position:absolute;right:0;height:21px;cursor:pointer}
.themebg_set{width:267px;margin:15px auto 0;}.themebg{float:left;position:relative;width:106px;height:106px;padding:2px;border:2px solid #32A1CC}.themebg .nobg{cursor:default;height:106px;color:#999;line-height:106px;text-align:center;background-color:#EFEFEF}.themebg .loading{padding-left:16px;background-position:20% 50%}.themebg .imgbg{width:106px;text-align:center;overflow:hidden}.themebg .imgbg img{height:106px}.themebg .del{position:absolute;top:0;right:0;width:18px;height:18px;background-position:-35px -124px}.bgSetting{float:right;width:143px;padding-top:38px}.bgPosition{width:150px;height:22px;margin:5px 0;background-position:0 -168px}.bgPosition a{display:inline-block;width:38px;height:19px;padding-top:1px;margin:1px;color:#333;line-height:19px;text-align:center; vertical-align:middle;}.bgPosition a:hover{text-decoration:none;background-color:#FDFDFD}.bgPosition a.select,.bgPosition a.select:hover{color:#fff;background-position:-64px -145px}.bgSetting label{margin-right:8px;white-space:nowrap}.themecolorWrap{position:relative;float:left;width:252px;height:203px;padding:0 4px 0 9px;border:1px solid #DFDFDF}.themecolorWrap h4{height:24px;padding-top:3px}.themePreview{float:left;}.D2 .colorBox{height:29px;padding-left:1px}.D2 .color{display:inline-block;width:16px;height:16px;padding:3px;background-position:0 -192px}.D2 .colorBox .select{position:relative;background-position:-24px -192px}.TpreviewBox{width:112px;height:110px;overflow:hidden;*zoom:1;padding:10px;border:1px solid #DFDFDF}.Tmain,.Tface{background:#fff url(http://mat1.gtimg.com/www/mb/images/skinFixmod.png) no-repeat}.Tmain{float:left;width:77px;height:110px;margin-right:-1px}.Tside{float:right;width:34px;height:110px;}.TUIn{width:28px;padding:6px 3px 2px;overflow:hidden;*zoom:1}.Tface{float:left;width:14px;height:14px;margin-bottom:4px;background-position:-81px 0}.Tnums{float:right;width:12px}.Tside .textColor{width:12px;height:3px;overflow:hidden;margin-bottom:1px;background:#9C000D}.Tside .linkColor{clear:both;width:50%;height:2px;overflow:hidden;margin-bottom:2px;background:#FFA869}.Tside .sepLine{height:0;overflow:hidden;border:1px solid;border-width:1px 0}.TsideMod{width:28px;margin:4px auto}.TsideMod .textColor{margin-bottom:3px}.TsideMod .linkColor{width:16px}.ThotList .SA{z-index:0;left:0;top:-5px;*top:-6px;_top:-5px}.ThotList .SA *{width:18px;height:5px}.ThotList .SA span{left:0;top:1px}.ThotList{margin-top:3px;height:12px}.palettelist{float:right;position:relative;width:108px;overflow:hidden}.paletteWrap{height:142px;width:1000px;overflow:hidden}.paletteWrap li{float:left;width:108px}.palettes,.palettes *{display:block;height:27px;overflow:hidden;}.palettes{position:relative;float:left;width:48px;padding:3px;margin:4px 0 10px;cursor:pointer}.palettes .c{float:left;width:8px}.palettes .mask{position:absolute;top:0;left:0;clear:both;width:54px;height:33px;background-position:0 -218px}.paletteWrap .select .mask{background-position:-56px -218px}.D2 .themeDiy .pages{position:absolute;right:4px;bottom:15px;clear:both;width:108px;height:16px;overflow:hidden;padding:0;border:none}.themeDiy .pages *{float:left;margin:0}.themeDiy .pages a{width:20px;height:16px;background-position:-74px -124px}.themeDiy .pages .btn_prev_disabled{background-position:-59px -124px;cursor:default}.themeDiy .pages .btn_next{background-position:-102px -124px}.themeDiy .pages .btn_next_disabled{background-position:-87px -124px;cursor:default}.themeDiy .pageInfo{width:68px;text-align:center}.themeHisWrap{position:absolute;left:15px;bottom:13px;*bottom:17px;height:24px;overflow:hidden;*zoom:1;line-height:25px}.themeHis{float:left;width:16px;height:16px;padding:2px;margin:1px 2px;overflow:hidden;border:1px solid #DFDFDF;background-position:center top;cursor:pointer}.themeHis .Tmain{filter:alpha(opacity=10);opacity:0.1;width:9px;height:16px;background:#fff}.themeHis .Tside{width:6px;height:16px}.themeHisWrap .select{margin:0 1px;border:2px solid #32A1CC}.colorPickerPosition{position:absolute;height:0;margin:-31px 0 0 -222px}</style>

<div class="changestylepop" style=" position:absolute;z-index:999;">
     <div class="DWrap"><div class="DLoad" style="width: 586px; height: 308px; display: none; "></div><div class="DCont" style=""><div class="DtabTitle"><ul>
			
					<li class="select"><b>自定义皮肤</b></li>
					
		</ul>
	<span class="right"></span>
</div>
<div class="themeDiy"  style="display:block;">
	<div class="themebgWrap"  style="display:block;">
		
		
		<div class="themebg_sel">
		<p><form action="index.php?app=home&mod=Widget&act=addonsRequest&addon=SpaceStyle&hook=saveImageTemp" enctype="multipart/form-data" method="post" id="uploadpic" >
		<input type="file" class="inputTxt" hidefoucs="true" name="pic" onchange="oSpaceStyle.oBackground.fSetImage(this, this.value);"></form></p>
		<p>支持2M以内的gif、jpg、jpeg、png图片上传</p></div>
       <div class="themebg_set">
			<div class="themebg"><div class="nobg" id="nobg">未上传图片</div><div class="nobg loading" id="loading" style="display:none;">上传中..</div><div class="imgbg" style="display:none" id="success_img"><a href="javascript:oSpaceStyle.oBackground.fUnsetImage(this)" class="del" title="删除"></a><img src="{$pic}" id="success_pic"></div></div>
			<div class="bgSetting"><p>设置背景图</p><p class="bgPosition"><a href="#" rel="left" onclick="return oSpaceStyle.oBackground.fSetPosition(this)">居左</a><a href="#" rel="center" onclick="return oSpaceStyle.oBackground.fSetPosition(this)">居中</a><a href="#" rel="right"  onclick="return oSpaceStyle.oBackground.fSetPosition(this)">居右</a></p><p>
				<label><input type="checkbox" class="check1" name="repeat" onclick="oSpaceStyle.oBackground.fSetRepeat(this);" value="repeat"/>背景平铺</label>
				<label><input type="checkbox" class="check1" name="attachment" onclick="oSpaceStyle.oBackground.fSetAttachment(this);" value="fixed">背景固定</label>
			</p></div>
		</div>
	</div>
	<div class="themecolorWrap">
		<h4>页面配色方案</h4>
		<div class="colorPickerPosition"></div>
		<div class="themecolor">
			<div class="themePreview">
				<div class="colorBox ">
				 <volist name="defaultStyle" id="vo">
        <span class="{$vo} <php>if($defaultStyle[$classname]==$vo){</php> isborder<php>}</php>" onclick="oSpaceStyle.fChange('{$key}',$(this));" ></span>
      </volist>
				</div>
				<div class="TpreviewBox" style=" float:left; margin-left:60px; display:none;">
				
					
				</div>
			</div>
			
		</div>
	</div>
	</div>

<div class="funBoxx">
<input type="button" class="btn_b buttonObj" value="保存" onclick="oSpaceStyle.fSave();" style="margin: 10px;">
<input type="button" class="btn_b buttonObj" value="恢复默认" onclick="oSpaceStyle.fDefault()" style="margin: 10px;">
<input type="button" class="btn_b buttonObj" value="取消" onclick="oSpaceStyle.fCancel();" style="margin: 10px;">
</div>
</div></div></div>
<script>
var is_upload=0;
var is_save=0;
var defaultStyle = <?php echo json_encode($defaultStyle); ?>;

$.extend(oSpaceStyle, {
	oStyleData: {
		classname: "<?php echo $classname; ?>",
		background: {
			color: "<?php echo $background['color']; ?>",
			image: "<?php echo $background['image']; ?>",
			repeat: "<?php echo $background['repeat']; ?>",
			attachment: "<?php echo $background['attachment']; ?>",
			position: "<?php echo $background['position']; ?>"
		}
	},
	nIsChange: 0,
	fInitBox: function() {
		var $SpaceStyleBox = this.$SpaceStyleBox,
			sColor = this.oStyleData.background.color,
			sImage = this.oStyleData.background.image,
			sRepeat = this.oStyleData.background.repeat,
			sAttachment = this.oStyleData.background.attachment,
			sPosition = this.oStyleData.background.position;

		if ( sImage ) {
			$('#nobg').hide();
		    $('#success_img').show();
			$('#success_pic').attr('src',sImage);
		}
		( "repeat" === sRepeat ) && $SpaceStyleBox.find( "input[name='repeat']" ).attr( 'checked', 'checked' );
		// ( "fixed" === sAttachment ) && $SpaceStyleBox.find( "input[name='attachment']" ).attr( 'checked', 'checked' );
		sPosition && $SpaceStyleBox.find( ["a[rel='", sPosition.replace('top ', ''), "']"].join( "" ) ).addClass( "select" );
	},
	fChange: function(type,obj) {        
        for(var one in defaultStyle){
            if(one == type){
                obj.addClass('isborder');
               }else{
                $("."+defaultStyle[one]).removeClass('isborder');
                
            }
        }
		 
		var path='addons/plugins/SpaceStyle/html/'+type+'.css'	;
		
		if(is_upload=='1'){		
				this.oBackground.fUnsetImage();		
				$('body').attr('style','');		
				}	
       $('#change_skin').attr('href',path);
		this.oBackground.fUnsetImage();
        this.oStyleData.classname = type;
        this.nIsChange = 1;
        return true;
    },
    oBackground: {
    	fSetColor: function() {
        	oSpaceStyle.nIsChange = 1;
    	},
		fSetImage: function(o, str) {
		   var d=/\.[^\.]+$/.exec(str); 
		   if(d!='.jpg'&&d!='.jpeg'&&d!='.png'&&d!='.gif'){
			alert('仅支持【jpg,png,gif】后缀文件');
			$(o).val('');
			}
				else{

		var options = {
				    success: function(txt) {
						if(txt){
					    var Images='top '+$('a.select').attr('rel');
						var repeats=$('input[name=\'repeat\']').attr('checked');
						if(repeats){
						  var repeat='repeat';
						}else{
						  var repeat='no-repeat';
						}
						var fix=$('input[name=\'attachment\']').attr('checked');
						if(fix){
						  var fix_Ed='fixed';
						}else{
						  var fix_Ed='scroll';
						}
						
					    $('#success_img').show();
						$('#success_pic').attr('src',txt);
					    $('#loading').hide();
						$('body').css({"background-image":"url("+txt+")","background-position":""+Images+"","background-repeat":""+repeat+"","background-attachment":""+fix_Ed+""});
							is_upload=1;
		    				oSpaceStyle.oStyleData.background.image = txt;
						}else{
							ui.error('文件不能大于2MB');
							$('input[type=\'file\']').val('');
							}
						
				 }
		}

				$('#uploadpic').ajaxSubmit( options );
			    $('#nobg').hide();			   
			    $('#success_img').hide();
			    $('#loading').show();
			}
        	oSpaceStyle.nIsChange = 1;			
		},
		fUnsetImage: function() {
			var imagePath=$('#success_pic').attr('src');

			$('#nobg').show();	 
			$('#loading,#success_img').hide();
			$('input[name=\'pic\']').val('');
			$('#success_pic').attr('src','');	
			is_upload=0;

			$( "#change_background" ).html( "" );
			$('body').css({"background-image":"","background-position":"","background-repeat":"","background-attachment":""});
        	oSpaceStyle.oStyleData.background.image = '';
        	oSpaceStyle.nIsChange = 1;
		},
		fSetRepeat: function(obj) {
            var repeats=$('input[name=\'repeat\']').attr('checked');
			if(repeats==true){
			  var repeat='repeat';
			}else{
			  var repeat='no-repeat';
			}
			$('body').css('background-repeat',repeat);
        	oSpaceStyle.oStyleData.background.repeat = repeat;
        	oSpaceStyle.nIsChange = 1;
		},
		fSetAttachment: function(obj) {
            var fix=$('input[name=\'attachment\']').attr('checked');
			if(fix==true){
			  var fix_Ed="fixed";
			}else{
			  var fix_Ed='scroll';
			}
			$('body').css('background-attachment',fix_Ed);
        	oSpaceStyle.oStyleData.background.attachment = fix_Ed;
        	oSpaceStyle.nIsChange = 1;
		},
		fSetPosition: function(obj) {
		  $('a.select').removeClass('select');
		  $(obj).addClass('select');
		  var rel=$(obj).attr('rel'),
		  		position = 'top '+rel+'';
		  $('body').css('background-position', position);
        	oSpaceStyle.oStyleData.background.position = position;
        	oSpaceStyle.nIsChange = 1;
          return false;
		}
    },
	fDefault: function() {
		this.oStyleData.classname = '';
		this.oStyleData.background.color = '';
		this.oStyleData.background.image = '';
		this.oStyleData.background.repeat = '';
		this.oStyleData.background.attachment = '';
		this.oStyleData.background.position = '';
		this.fSave();
		setTimeout( function() { window.location.reload() }, 800);
	},
	fSave: function() {
		var oSpaceStyle = this;

		$.post('{:Addons::createAddonUrl('SpaceStyle', 'saveStyle')}', oSpaceStyle.oStyleData, function(txt){
			txt = eval("(" + txt + ")");
			if (txt.status) {
				oSpaceStyle.fHideBox();
				ui.success(txt.info);
				is_save=1;
        		oSpaceStyle.nIsChange = 0;
			} else {
				ui.error(txt.info);
			}
			oSpaceStyle = null;
		});
	},
	fCancel: function() {
		switch ( this.nIsChange ) {
			case 1:
				window.location.reload();
			default:
				oSpaceStyle.fHideBox();
		}
	}
});

$(document).ready(function(){
	oSpaceStyle.fInitBox();
});
</script>